<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>レシート管理アプリ - 確定申告用経費管理</title>
    <meta name="description" content="レシートを撮影・アップロードして経費を自動管理。確定申告に便利なCSV出力機能付き。">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">📄 レシート管理</h1>
                <nav class="nav-tabs">
                    <button class="nav-tab active" data-tab="upload">アップロード</button>
                    <button class="nav-tab" data-tab="list">経費一覧</button>
                    <button class="nav-tab" data-tab="summary">集計</button>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Upload Section -->
            <section id="upload-section" class="section active">
                <div class="card upload-card">
                    <div class="upload-area" id="upload-area">
                        <div class="upload-icon">📷</div>
                        <p class="upload-text">レシートをドラッグ＆ドロップ</p>
                        <p class="upload-subtext">または</p>
                        <div class="upload-buttons">
                            <label class="btn btn-primary" for="file-input">
                                ファイルを選択
                            </label>
                            <label class="btn btn-secondary" for="camera-input">
                                📸 カメラで撮影
                            </label>
                        </div>
                        <input type="file" id="file-input" accept="image/*" hidden>
                        <input type="file" id="camera-input" accept="image/*" capture="environment" hidden>
                    </div>
                </div>

                <!-- Image Preview -->
                <div class="card preview-card" id="preview-card" style="display: none;">
                    <h2 class="card-title">プレビュー</h2>
                    <div class="preview-container">
                        <img id="preview-image" src="" alt="レシートプレビュー">
                    </div>
                    <div class="ocr-status" id="ocr-status">
                        <div class="spinner"></div>
                        <span>読み取り中...</span>
                    </div>
                </div>

                <!-- Expense Form -->
                <div class="card form-card" id="form-card" style="display: none;">
                    <h2 class="card-title">経費情報</h2>
                    <form id="expense-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-date">日付</label>
                                <input type="date" id="expense-date" required>
                            </div>
                            <div class="form-group">
                                <label for="expense-amount">金額（税込）</label>
                                <div class="input-with-unit">
                                    <input type="number" id="expense-amount" placeholder="0" required>
                                    <span class="unit">円</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="expense-vendor">店舗・相手先名</label>
                            <input type="text" id="expense-vendor" placeholder="例: コンビニ○○店">
                        </div>
                        <div class="form-group">
                            <label for="expense-category">経費項目</label>
                            <select id="expense-category" required>
                                <option value="">選択してください</option>
                                <optgroup label="🚗 配達業向け">
                                    <option value="ガソリン代">ガソリン代</option>
                                    <option value="車両費">車両費（車検・修理・メンテナンス）</option>
                                    <option value="駐車場代">駐車場代</option>
                                    <option value="高速道路代">高速道路代（ETC）</option>
                                </optgroup>
                                <optgroup label="💇 美容師向け">
                                    <option value="消耗品費">消耗品費（ハサミ・薬剤等）</option>
                                    <option value="衛生費">衛生費（タオル・消毒液等）</option>
                                    <option value="研修費">研修費（セミナー・講習会）</option>
                                </optgroup>
                                <optgroup label="🎨 AI漫画家向け">
                                    <option value="ソフトウェア費">ソフトウェア費（サブスク等）</option>
                                    <option value="機材費">機材費（PC・タブレット等）</option>
                                </optgroup>
                                <optgroup label="📋 共通">
                                    <option value="通信費">通信費（ネット・電話）</option>
                                    <option value="広告宣伝費">広告宣伝費</option>
                                    <option value="事務用品費">事務用品費</option>
                                    <option value="書籍・資料費">書籍・資料費</option>
                                    <option value="接待交際費">接待交際費</option>
                                    <option value="旅費交通費">旅費交通費</option>
                                    <option value="雑費">雑費</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="expense-memo">メモ（任意）</label>
                            <textarea id="expense-memo" rows="2" placeholder="補足情報があれば入力"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" id="cancel-btn">キャンセル</button>
                            <button type="submit" class="btn btn-primary">登録する</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- List Section -->
            <section id="list-section" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">経費一覧</h2>
                        <div class="card-actions">
                            <button class="btn btn-secondary btn-sm" id="export-csv-btn">
                                📥 CSV出力
                            </button>
                        </div>
                    </div>
                    <div class="filter-bar">
                        <select id="filter-month">
                            <option value="">全期間</option>
                        </select>
                        <select id="filter-category">
                            <option value="">全カテゴリ</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table class="expense-table" id="expense-table">
                            <thead>
                                <tr>
                                    <th>日付</th>
                                    <th>項目</th>
                                    <th>店舗名</th>
                                    <th class="text-right">金額</th>
                                    <th class="text-center">操作</th>
                                </tr>
                            </thead>
                            <tbody id="expense-tbody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                    <div class="empty-state" id="empty-state">
                        <div class="empty-icon">📋</div>
                        <p>まだ経費が登録されていません</p>
                        <p class="empty-subtext">レシートをアップロードして始めましょう</p>
                    </div>
                    <div class="list-total" id="list-total">
                        <span>表示中の合計:</span>
                        <span class="total-amount" id="filtered-total">¥0</span>
                    </div>
                </div>
            </section>

            <!-- Summary Section -->
            <section id="summary-section" class="section">
                <div class="summary-grid">
                    <!-- Total Card -->
                    <div class="card summary-total-card">
                        <h3>総経費額</h3>
                        <div class="big-number" id="total-amount">¥0</div>
                        <p class="summary-period" id="summary-period">2024年1月〜現在</p>
                    </div>

                    <!-- Monthly Summary -->
                    <div class="card">
                        <h2 class="card-title">月別集計</h2>
                        <div class="chart-container" id="monthly-chart">
                            <!-- Dynamic bars -->
                        </div>
                    </div>

                    <!-- Category Summary -->
                    <div class="card">
                        <h2 class="card-title">カテゴリ別集計</h2>
                        <div class="category-list" id="category-list">
                            <!-- Dynamic list -->
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Toast Notification -->
        <div class="toast" id="toast">
            <span class="toast-message"></span>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
